<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="../stylesheets/core.css" media="screen">
    <link rel="stylesheet" href="../stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)">
    
    <script data-ad-client="ca-pub-4602280977756527" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-storage.js"></script>
    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyDQCO5r-ICvbJe4FIKkPeq8Ayh-NT_cTqU",
        authDomain: "pc-builder-283416.firebaseapp.com",
        databaseURL: "https://pc-builder-283416.firebaseio.com",
        projectId: "pc-builder-283416",
        storageBucket: "pc-builder-283416.appspot.com",
        messagingSenderId: "521975959454",
        appId: "1:521975959454:web:f2377f67fe2adbdfc8108f",
        measurementId: "G-26MWMG7FCD"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
    </script>


    <title>PC Builder</title>
    
  </head>

  <body>

    <div class="header">
    <h1 id="title_pages">~~~ PC-Builder.ca ~~~</h1>
    <p style="margin-top: 5vh;"><a href="https://www.kijiji.ca/o-profile/1012850972/listings/1" target="_blank">Link to my Kijiji page!</a></p>
    </div>

    



    
    <div style="margin-top:5vh;">
      <p id="no_listings" style="position: fixed;margin-top: 5vh;width: 100%;text-align: center;color:darkred;font: 3.5em 'Raleway';text-shadow: 4px 4px white;">
          Loading...
          
          <table class="current_builds_table">


          </table>
 



        </p>
  </div>

  <div class="div_table" style="height:8vh">
  <table class="products_page_table">
    <th><a href="home.html">Home</a></th><th><a href="products.html">Products</a></th><th><a href="previousbuilds.html">Previous Builds</a></th><th><a href="contact.html">Contact Me</a></th>
    </table>
  </div>

    <script>

                    var db = firebase.firestore();
                    var storage = firebase.storage();
                    var storageRef = storage.ref();
                    var imageURL = "";
                    var path = "";
                    var list_of_computers = "";

                    var paths = new Array();
                    var docs = new Array();

                    var builds_are_available;

                    buildList(imageURL);
                    async function buildList(imageURL){
                    await db.collection("current_builds").orderBy('cpu').get().then((querySnapshot) => {

                      
                        querySnapshot.forEach((doc) => {
                          if (doc != null){
                            builds_are_available = true;
                            path = storageRef.child('current_builds/' + doc.id + '.JPG');
                            paths.push(path);
                            docs.push(doc);
                          }
                        });
                        if(builds_are_available == true){
                          document.getElementById("no_listings").innerHTML = "";
                          getURL();
                        }
                        else{
                          var nolistings = "<br><br>Sorry, no listings currently.<br>Please check back later!";
                          document.getElementById("no_listings").innerHTML = nolistings;
                        }

                    });

                    }

                    async function getURL(){
                      var count = paths.length;
                      for (var i = 0; i < count; i++){
                        var local_path = paths[i];
                        var local_doc = docs[i];
                        await local_path.getDownloadURL().then(async function(url){
                        await sendURL(url, local_doc);

                        }).catch(function(error) {
                        console.error(error);
                        });
                      }
                      
                    }

                    async function sendURL(path, doc){
                        await list(path, doc);
                    }


                    async function list(path, doc){
                      var pc = doc.data();
                      list_of_computers += "<tr class=\"listing\">" +
                        "<th id=\"product_image\" style=\"width:20vw; height:30vh\"><img src=\"" + path + "\"></th>"
                        + "<div id=\"new_line\"></div>";
                        document.getElementsByClassName("current_builds_table")[0].innerHTML = list_of_computers;
                        
                        var x = document.getElementById("new_line");
                        if (window.getComputedStyle(x).display === "none") {
                          list_of_computers +=
                         "<th id=\"product_listing\"><h id=\"product_name\"><b>" + pc.cpu + "</b></h>" +
                          "<p id=\"product_description\" style=\"text-align:left;\">" + 
                          "GPU: " + pc.gpu + "<br>" + 
                          "RAM: " + pc.ram + "<br>" + 
                          "Motherboard: " + pc.motherboard + "<br>" + 
                          "PSU: " + pc.psu + "<br>" + 
                          "OS: " + pc.os + "<br>" + 
                          "</p></th></tr>";
                        }
                        else {
                          list_of_computers += 
                         "<tr><th id=\"product_listing\"><h id=\"product_name\"><b>" + pc.cpu + "</b></h>" +
                          "<p id=\"product_description\" style=\"text-align:left;\">" + 
                          "GPU: " + pc.gpu + "<br>" + 
                          "RAM: " + pc.ram + "<br>" + 
                          "Motherboard: " + pc.motherboard + "<br>" + 
                          "PSU: " + pc.psu + "<br>" + 
                          "OS: " + pc.os + "<br>" + 
                          "</p></th></tr>";
                        }
                      

                            document.getElementsByClassName("current_builds_table")[0].innerHTML = list_of_computers;
                           
                    }





    </script>




  </body>
</html>
